sudo: required
language: java
jdk:
- openjdk11
before_install:
- openssl aes-256-cbc -K $encrypted_033a38c09167_key -iv $encrypted_033a38c09167_iv
  -in travis/codesigning.asc.enc -out travis/codesigning.asc -d
- export COMMIT_SHORT=$(git rev-parse --short HEAD)
- rm "${JAVA_HOME}/lib/security/cacerts"
- ln -s /etc/ssl/certs/java/cacerts "${JAVA_HOME}/lib/security/cacerts"
script:
- ./mvnw clean install
- |
  set -e
  if [ "$TRAVIS_BRANCH" = 'master' ] && [ "$TRAVIS_PULL_REQUEST" == 'false' ]; then
     echo "Importing GPG key into keyring"
     gpg --fast-import travis/codesigning.asc
     ./mvnw versions:set -DnewVersion="$COMMIT_SHORT"

     echo "Running release"
     ./mvnw --settings travis/settings.xml deploy -Prelease -DskipTests=true
  fi
env:
  global:
  - GPG_KEY_NAME=navikt
  - OSSRH_JIRA_USERNAME=navikt
  - secure: NlEjxSNoaD4omOnA+zU6uO38tJQhTw++CjDc42EYRdaLckM12wz/qPFnPuha3bS5qNHH68CjblykTuiv2rDWxFcH6AMannLGdDZcsAvPBVX3QCN3Mz7YLny+0fmbKma6+cmgDOCU3uDg9cKdeHpfu7OuZgTtu4J/Y28lzLq/tefK2UPRk6kbyqC06v1DeoAd3YyJ5IzhXaVy0uIsSMkL3zgL5UXBdNJs4ZNcwM6MaqPtlMO97I+OvPmpNoomHkVVz7nrSNs9YaTE8119A/jZAebWeGzyMgnUAMInd0XSbEX7lplWxURS/CUXX4Hmj52/blJ3iy2OHvCWrapgXhaTxTGQVntJbsWb9NpSMATWUYiJJPVjVcDv4wDLRBAOmqeJiBFkyxl3clI0GT3ED3qMQfwNYqvkox8XyaafJkYS8It4BdxetX3zW6vD46Wtgf/YDEv7gt489hKgQaK2o/hKafuXjLFAXhKhohRCaJJEcsguvXP3MVVX7kmrdSTTV7T+7CKjZGuEdoX4npklWXQGj1B5zKgQ+d0vLfgoj2o93h1+ZC+Ht2+YenbW9+lOYckFhe3q2P0OAPXi5k3UX8ehK7blz5c9fFIN0CsQpoXlHbXKbER83fxUTmYiojT0+ves//+Qa3EUeiYYyTHg6vl7/muHPjew6mcU6l+mRVM1bv0=
  - secure: Vr7MB0Jk0RzUFOilz/fKcVhX55bIa8JpXTZCmvAQU/Gw5UfiRYas70hpFju+ru1lAadZw3Ln447JxzwBjbumScfBg2cMF7xddqNOOXOwl4Lo96zSpBVqRHEWYWCzGoJMV/6QI+ZCoOrH+yCaAVZhmgPXyBFa5CaV710ddznTq1ZhifYCcjRgR7yx1xV2Y3cqpnqFzOSAZGSl3hA/RHuXfM5UyNzWP8Kw1dbgTC+pwk7771gD57oZltRzeU//xADpwzpWPdQiPriwV7uGdloWSCMlsp0WQY23beJ+Jt0ZH0Z+atdyNXnBHQjIqk8T/NZTqPlRuyz4TQH5tfobAHWYhLvEEc9A8LXupXVD6A/+Yt0xDTY5zUAJlSIiJuHkMEkptf2EWoDF51If+rC0zae6P2kSlYsuIijr5Ft3nWhdIW6h0ljMgswAHr1h8XE/AiWsBP6c3zuiH+v+RUvvo7UqbB7vHwZIV69heYI7Y9pleCR8OsgqLNTsSEE9SN7wuEKKBFAhiKzoFFMvqoLt3NJe97PQnYeX6W3z80d/2JHpBenYbKP10eBOMC334QUK549V8wxCIst5cOyS5KmtyRE+4Yfdgq2+m83Hh/sFARHk+r6kXOuluYPHYosMGKRAlXUdDIujN2VwWYjyMHDY5oQA8TlMUoYZ48Ypw4HUzhIKEbs=
  - secure: PDvZ6GebCjIu0gzGFGUxI/4pAb5RvqgXjBKbbBw0J1Fr7UXYR0A+y4HhGWUK936KMAs6TLkLF3XW9152xUqO4TqQ1JnRvwhN3Cq436TiS25RDBXxxU145aG8kt4l5gp7O7/yDXxkThZOkG2yPZ04y9NyUXjjnaJ1rhsObFoNp8VNqs//VqweUf69+zCxMuZRvzQUyDB8nmYfcZ2lhbJ0rVjdCMjWXnit2WDoNbQMC+r8TmrV5otr5j6f22o+bqTeabwnk5VV/zXyVzD4IrNXkobreQ4OHn7WgLw4YHUdhePcU1sB8U1KLFFY/As/bSbBkdVL7tSBohHEIPLAKXbEIDGh6cbFm9iOEnVi8DYZ8YYj0LFz2sOdslFubWiIMkptgnztDDOPtYuxF013ixWLcQsuzVaFd1t8Dc3/FLWtu/dRB9mJagvZlZierM9A8yybZdsOSgeLtAoUZ7bZmNCroooLBuz6JZsvVROjGqlvu7JdVHW+5xZSgdvhP9wGXPTBovLKX2Jp09lMH7nJdf8a9EE/kxCB8j5w6e2BkA9AyAj2dK3aAT1CvnFWQdVId7o9x7ZlVUw5sfUGn7w9QMiSZLzCffSvhh9NkH1MQPwJx7ATAV4Nkgz3DtXRTosqFyCUOCCe7brvpINutQ+luXusLUpJ+0cKr3j77uKdFlTGjX0=
  - secure: PqABRk2zQUUgbd+ATmj/Z0LRQdT5dnzj74PBIJRpoP5Qk/UJfTtZhsgGaIcTfN6Y1e4ut/E3+NMD6ADOWjkfao8HkW/w/tdkmAyKRQzcvvQc7wPg9kBByfZ3mdYHx/EZDqk2VIEFmA6hRmJW6dc09gymX1tfMfnOThM7N8E6r8+P5OO4diERnId1FCc4BfhDAZgBdWLveDpjVh67VxNT/ca9oasGeJOdlScTJpLQM5ZkkZYr8ahALjmvN4g3mg3KBow01l9Q3RAiv4bPP9RsuRFn6dZPvvaeIGsn9QjhNsw+qGOPgyhBES5jxqxOaWBfaOZH58ztqb3aNJhO1tEJ3TdMu59iYzj0XpernzX/M84M0rlbSe51Nh1QNAuKaN4UdwdqnjMJ0LO193iesFhzrYWaptfXShUrr94agfUSnZUR8Qlcy1NSOqz2o0vy6mj+t8QDsHTXLxoB/99GICUAH8bP1q6RTbqpusGd2+XIHLE7smMaZC3kjQ8sQtZ6GDUtNso96CfR+7URfa9hifeK6+x3x9NW1eVT1EO2ewwOMktJojwNmuWe+mRnerDkJ45F+bqVNxsvsSc2spJ6ncFI8rHAgEXdfVAmDyfG4dGHlSK6G6gVJDem1rpxkNyXzq6PKFbY+uJeD/7NeZFTmrr18ctxlPdme5aVO6JrY1RjSFc=
notifications:
  slack:
    secure: RCMjtPG1RinzKu8VKKKx/IUNy+7ZPZDvKGYbzS5lGpBS6yhFzLnG1d8KRahLljR+tRgnhBfYLxjJWRYjElyAVYRtQv7qjvLMN5Q424ZpvwmYKxBDXcnDpb/fdECZaghUGiwfDBtwFEejQQ2XWTtePdeV6r8Km/6tr+wpJT7hhXmUibX2g+KOvw6cqoYLzKWi/CdoJYpd4Mw0r+dZq9t2T57E50wyMMrwzYPkSj5RXVQ9s+KCKkybUwBQv2wHEhIfSwZujik5R4fIIoqRRAKfLWtynSGmDUuxKzXYxs6L68YiuWjrLTkrZY/jIeoOQzKwLneP16y8a6sPERkB6WoUeLc/DNcc23fvoueWgqIOKDeEe5RPj+HA+Z2cwcKLTG6YLo8rNuPx336q2e8lf9RlCQZxPWABNdT5onOgr5QuIpZBgP+HKpC1dMeL1fGjRlC/as4W0PsWWdaygTMcRQuLx/1aj+n1+h4bVwMI2mBVg1kN0TGa6w5RJNLw/mIUr5IUcDsC04+HpsV4qM9A6lma7QNh0P+Xf+JPqh0KA0hxQYPDdOJ/xiXyyG8nmoHAlFLAepm8Z4JGAktWBIvOTvFm5MgoUcjShJeJB8SJY5OSmIH6QtlqdxHQN/fwIEdpEfViegy8VHtodPmlAl2k450wk+QSqZjQ9Sj8IsYni0TETu8=
